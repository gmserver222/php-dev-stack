name: Lint - Dockerfile & Makefile

on:
  pull_request:
    paths:
      - 'docker/**/Dockerfile'
      - 'Makefile'
      - '.github/workflows/lint.yml'
  push:
    branches: [ main ]

jobs:
  lint:
    name: ğŸ” Lint Dockerfiles & Makefile
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ’¾ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“„ Install Hadolint
        run: |
          sudo wget -O /usr/local/bin/hadolint https://github.com/hadolint/hadolint/releases/latest/download/hadolint-Linux-x86_64
          sudo chmod +x /usr/local/bin/hadolint

      - name: ğŸ“Š Lint Dockerfiles
        run: |
          find docker/php -name Dockerfile -exec hadolint {} \;

      - name: ğŸ“„ Install CheckMake
        run: |
          curl -sSL https://github.com/checkmake/checkmake/releases/download/0.2.2/checkmake-0.2.2.linux.amd64 -o /usr/local/bin/checkmake
          chmod +x /usr/local/bin/checkmake

      - name: ğŸ§ª Debug CheckMake File
        run: file /usr/local/bin/checkmake

      - name: ğŸ” Check Makefile syntax
        run: checkmake Makefile
